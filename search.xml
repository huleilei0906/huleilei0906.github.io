<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AOPå®æˆ˜-AspectJ</title>
    <url>/2020/05/27/AOP%E5%AE%9E%E6%88%98-AspectJ/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>ç”¨è¿‡Springçš„éƒ½çŸ¥é“DIå’ŒAOPï¼Œä»Šå¤©ä»‹ç»ä¸€ä¸ªå®ç°AOPè¶…çº§ä¸”æ–¹ä¾¿åŠŸèƒ½å¼ºå¤§çš„æ¡†æ¶AspectJã€‚æ­¤æ–‡é»˜è®¤è¯»è€…æœ‰ä¸€å®šspringåŸºç¡€ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><blockquote>
<p>JDKï¼š1.8</p>
<p>æ¶æ„ï¼šSpringBoot</p>
</blockquote>
<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3. è¯¦è§£"></a>3. è¯¦è§£</h1><h2 id="3-1-åŸºç¡€æ¦‚å¿µ"><a href="#3-1-åŸºç¡€æ¦‚å¿µ" class="headerlink" title="3.1 åŸºç¡€æ¦‚å¿µ"></a>3.1 åŸºç¡€æ¦‚å¿µ</h2><p>Aspectï¼šåˆ‡é¢</p>
<p>Pointcutï¼šåˆ‡ç‚¹ï¼Œé€šè¿‡ä¸åŒåˆ‡å…¥ç‚¹ï¼Œæ‰§è¡Œä¸åŒæ“ä½œï¼Œæ­¤æ–‡ä¸­å±•ç¤ºexecutionæ—¶æœºæ‰§è¡Œçš„æ“ä½œã€‚</p>
<p>Adviceï¼šé€šçŸ¥ï¼ŒåŒ…æ‹¬å‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ç­‰ç­‰ï¼›å…¶ä¸­ï¼Œç¯ç»•é€šçŸ¥åŠŸèƒ½æœ€ä¸ºå¼ºå¤§ã€‚æ­¤æ–‡å±•ç¤ºç¯ç»•é€šçŸ¥ç”¨æ³•ã€‚</p>
<h2 id="3-2-AspectJä¾èµ–ï¼š"><a href="#3-2-AspectJä¾èµ–ï¼š" class="headerlink" title="3.2 AspectJä¾èµ–ï¼š"></a>3.2 AspectJä¾èµ–ï¼š</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-ä»£ç å®ç°"><a href="#3-3-ä»£ç å®ç°" class="headerlink" title="3.3 ä»£ç å®ç°"></a>3.3 ä»£ç å®ç°</h2><a id="more"></a>

<p><code>step1</code>ï¼šé¦–å…ˆåœ¨SpringBooté…ç½®ç±»ä¸­æ·»åŠ æ³¨è§£@EnableAspectJAutoProxyï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>step2</code>ï¼šæ–°å»ºAspectjAop classï¼Œä½¿ç”¨@Aspectæ ‡è®°ä¸ºåˆ‡é¢ï¼Œæ³¨å†Œåˆ°Springå®¹å™¨ä¸­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectjAop</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>step3</code>ï¼šæ–°å»ºæ–¹æ³•controllerPointCutï¼Œæ·»åŠ Pointcutï¼Œåˆ‡ç‚¹æ—¶æœºä¸ºâ€œexecutionâ€ï¼ŒåŒ¹é…æ–¹æ³•ä¸ºcontrolleræŠ¥ä¸‹æ‰€æœ‰public æ–¹æ³•ã€‚å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œä¿¡æ¯å®‰å…¨è¿‡æ»¤ç­‰ç­‰æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectjAop</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤è·¯å¾„è¡¨ç¤ºcontrollerä¸‹æ‰€æœ‰ç±»ä¸­çš„publicæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * com..controller..*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">controllerPointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>step4</code>ï¼šæ·»åŠ Adviceï¼Œæ³¨å…¥æ‰§è¡Œä¸­åˆ‡ç‚¹å®ä¾‹ProceedingJoinPointï¼ŒProceedingJoinPointå¯ä»¥è·å–å…¥å‚ï¼Œæ§åˆ¶æ‰§è¡Œç­‰ç­‰æ“ä½œã€‚å¯ä»¥åœ¨æ‰§è¡Œæ–¹æ³•å‰åè¿›è¡Œæ–¹æ³•å¢å¼ºï¼Œå®ç°ä¸šåŠ¡ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AspectjAop</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤è·¯å¾„è¡¨ç¤ºcontrollerä¸‹æ‰€æœ‰ç±»ä¸­çš„publicæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * com..controller..*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">controllerPointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(value = <span class="string">"controllerPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">aroundAdvice</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Pre-operation</span></span><br><span class="line">        log.info(<span class="string">"You can check the parameters."</span>);</span><br><span class="line">        Object obj = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = proceedingJoinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            log.error(<span class="string">"controller throwable"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// TODOï¼šPost-operation</span></span><br><span class="line">        log.info(<span class="string">"You can encapsulate the return value."</span>);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Java</category>
        <category>AOP</category>
        <category>AspectJ</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>AOP</tag>
        <tag>AspectJ</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºæˆ‘</title>
    <url>/2020/05/25/AboutMe/</url>
    <content><![CDATA[<p>ğŸŒ±  Iâ€™m currently learning</p>
<p>Emailï¼š<a href="mailto:18861453337@163.com">18861453337@163.com</a></p>
]]></content>
  </entry>
  <entry>
    <title>ArrayListæ‰©å®¹æœºåˆ¶</title>
    <url>/2020/05/26/ArrayList%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>é¢è¯•çš„æ—¶å€™é—®åˆ°è¿‡ArrayListçš„æ‰©å®¹æœºåˆ¶ä»¥åŠHashMapçš„æ‰©å®¹æœºåˆ¶ï¼Œä»Šå¤©æ¥è®²è®²ArrayListçš„æ‰©å®¹æœºåˆ¶ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><p>JDK1.8</p>
<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3.è¯¦è§£"></a>3.è¯¦è§£</h1><h3 id="3-1-é»˜è®¤å®¹é‡"><a href="#3-1-é»˜è®¤å®¹é‡" class="headerlink" title="3.1 é»˜è®¤å®¹é‡"></a>3.1 é»˜è®¤å®¹é‡</h3><p> ArrayListè‹¥æœªæŒ‡å®šé•¿åº¦é»˜è®¤ç©ºé—´é•¿åº¦ä¸º10ï¼Œå¯è§ArrayListä¸­<strong>â€œDEFAULT_CAPACITYâ€</strong>å±æ€§ï¼Œ<strong>â€œsizeâ€</strong>å±æ€§ä¸ºå…ƒç´ ä¸ªæ•°ã€‚æœ€å¤§é•¿åº¦ä¸º2^31-1-8ï¼Œè§ArrayListä¸­<strong>â€œMAX_ARRAY_SIZEâ€</strong>å±æ€§ã€‚</p>
<h3 id="3-2-æ‰©å®¹"><a href="#3-2-æ‰©å®¹" class="headerlink" title="3.2 æ‰©å®¹"></a>3.2 æ‰©å®¹</h3><p> è§¦å‘æ‰©å®¹çš„å¯¹å¤–æ–¹æ³•éƒ½åœ¨ArrayList.add<em>()çš„å‡ ä¸ªæ–¹æ³•ä¸­ï¼Œå‘ç°é•¿åº¦å¤§äºç©ºé—´é•¿åº¦æ—¶è°ƒç”¨*</em>â€œgrow()â€**,æºç å¦‚ä¸‹ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    rangeCheckForAdd(index);</span><br><span class="line"></span><br><span class="line">    ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</span><br><span class="line">                     size - index);</span><br><span class="line">    elementData[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureExplicitCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>æ‰©å®¹ä¸»è¦æ“ä½œæ˜¯åœ¨ä»£ç å°±åœ¨grow()æ–¹æ³•ä¸­ï¼Œæºç åŠè§£æå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">   	<span class="comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="comment">// å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ–°è®¡ç®—å‡ºçš„å®¹é‡æ•°å€¼å’Œå®é™…æ‰€éœ€å®¹é‡æ•°å€¼æ¯”è¾ƒï¼Œè‹¥è®¡ç®—å‡ºçš„å®¹é‡æ•°å€¼å°äºå®é™…æ‰€éœ€å®¹é‡æ•°å€¼ï¼Œåˆ™ç”¨å®é™…å®¹é‡çš„æ•°å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥æ–°è®¡ç®—å‡ºçš„å®¹é‡æ•°å€¼æ˜¯å¦è¶…è¿‡ArrayListæœ€å¤§é•¿åº¦ï¼Œå¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œæ–°å®¹é‡ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`</span></span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    <span class="comment">// è°ƒç”¨copyæ–¹æ³•</span></span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hugeCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (minCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">    <span class="keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class="line">        <span class="comment">// MAX_ARRAY_SIZE = Integer.MAX_VALUE-8</span></span><br><span class="line">        Integer.MAX_VALUE :</span><br><span class="line">    MAX_ARRAY_SIZE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ArrayListæ‰©å®¹æœºåˆ¶å¦‚ä¸‹ï¼š</p>
<p>1.æ™®éæƒ…å†µä¸‹ï¼Œæ–°å®¹é‡æ˜¯æ—§å®¹é‡1.5å€ï¼ŒåŒæ—¶æ ¡éªŒæ–°å®¹é‡æ˜¯å¦è¶…è¿‡ MAX_ARRAY_SIZEï¼ˆInteger.MAX_VALUE - 8ï¼‰ã€‚</p>
<p>2.å½“åœ¨æ‰©å®¹1.5å€åï¼Œæ ¡éªŒæ–°å®¹é‡æ˜¯å¦è¶…è¿‡MAX_ARRAY_SIZEï¼ˆInteger.MAX_VALUE - 8ï¼‰ï¼Œè‹¥æ–°å®¹é‡ï¼ˆæºç ä¸­newCapacityï¼‰å¤§äºæœ€å¤§å®¹é‡ MAX_ARRAY_SIZEï¼ˆInteger.MAX_VALUE - 8ï¼‰æ—¶,æ–°å®¹é‡ä¸ºInteger.MAX_VALUEï¼Œå¦åˆ™ä¸º MAX_ARRAY_SIZEï¼ˆInteger.MAX_VALUE - 8ï¼‰;</p>
]]></content>
      <categories>
        <category>Java</category>
        <category>ArrayList</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ArrayList</tag>
      </tags>
  </entry>
  <entry>
    <title>MinIO</title>
    <url>/2020/06/29/Minio/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-ä»€ä¹ˆæ˜¯MinIO"><a href="#1-ä»€ä¹ˆæ˜¯MinIO" class="headerlink" title="1. ä»€ä¹ˆæ˜¯MinIO"></a>1. ä»€ä¹ˆæ˜¯MinIO</h1><h2 id="1-1-MinIOä»‹ç»"><a href="#1-1-MinIOä»‹ç»" class="headerlink" title="1.1 MinIOä»‹ç»"></a>1.1 MinIOä»‹ç»</h2><p>â€‹        MinIO æ˜¯ä¸€ä¸ªåŸºäºApache License v2.0å¼€æºåè®®çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ã€‚å®ƒå…¼å®¹äºšé©¬é€ŠS3äº‘å­˜å‚¨æœåŠ¡æ¥å£ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨å¤§å®¹é‡éç»“æ„åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½æ•°æ®å’Œå®¹å™¨/è™šæ‹Ÿæœºé•œåƒç­‰ï¼Œè€Œä¸€ä¸ªå¯¹è±¡æ–‡ä»¶å¯ä»¥æ˜¯ä»»æ„å¤§å°ï¼Œä»å‡ kbåˆ°æœ€å¤§5Tä¸ç­‰ã€‚</p>
<h2 id="1-2-MinIOä¿æŠ¤æ•°æ®ç­–ç•¥"><a href="#1-2-MinIOä¿æŠ¤æ•°æ®ç­–ç•¥" class="headerlink" title="1.2 MinIOä¿æŠ¤æ•°æ®ç­–ç•¥"></a>1.2 MinIOä¿æŠ¤æ•°æ®ç­–ç•¥</h2><p>â€‹        Minioä½¿ç”¨<strong>çº åˆ ç </strong><code>erasure code</code>å’Œæ ¡éªŒå’Œ<code>checksum</code>æ¥ä¿æŠ¤æ•°æ®å…å—ç¡¬ä»¶æ•…éšœå’Œæ— å£°æ•°æ®æŸåã€‚ å³ä¾¿æ‚¨ä¸¢å¤±ä¸€åŠæ•°é‡ï¼ˆN/2ï¼‰çš„ç¡¬ç›˜ï¼Œæ‚¨ä»ç„¶å¯ä»¥æ¢å¤æ•°æ®ã€‚</p>
<h1 id="2-MinIOéƒ¨ç½²"><a href="#2-MinIOéƒ¨ç½²" class="headerlink" title="2. MinIOéƒ¨ç½²"></a>2. MinIOéƒ¨ç½²</h1><h2 id="2-1-å•èŠ‚ç‚¹éƒ¨ç½²"><a href="#2-1-å•èŠ‚ç‚¹éƒ¨ç½²" class="headerlink" title="2.1 å•èŠ‚ç‚¹éƒ¨ç½²"></a>2.1 å•èŠ‚ç‚¹éƒ¨ç½²</h2><h3 id="2-1-1-ä¸‹è½½minio"><a href="#2-1-1-ä¸‹è½½minio" class="headerlink" title="2.1.1 ä¸‹è½½minio"></a>2.1.1 ä¸‹è½½minio</h3><p>æ ¹æ®å®é™…æ“ä½œç³»ç»ŸåŠä½æ•°ä¸‹è½½ç›¸åº”minio serverï¼ˆæ³¨ï¼šä¸æ˜¯minio clientï¼‰</p>
<p>è¿›å…¥<a href="https://dl.min.io/server/minio/release/linux-amd64/minioä¸‹è½½" target="_blank" rel="noopener">https://dl.min.io/server/minio/release/linux-amd64/minioä¸‹è½½</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;dl.minio.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="2-1-2-ä¸Šä¼ åˆ°linuxä¸‹"><a href="#2-1-2-ä¸Šä¼ åˆ°linuxä¸‹" class="headerlink" title="2.1.2 ä¸Šä¼ åˆ°linuxä¸‹"></a>2.1.2 ä¸Šä¼ åˆ°linuxä¸‹</h3><p>åœ¨ä¸Šä¸€æ­¥ä¸‹è½½çš„æ–‡ä»¶ç›®å½•ä¸‹æ·»åŠ shellè„šæœ¬(ä¾‹å¦‚ï¼šstartMinIO.sh)å¹¶è¿è¡Œ,å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<p>MINIO_ACCESS_KEYé…ç½®minioç™»å½•è´¦æˆ·</p>
<p>MINIO_SECRET_KEYé…ç½®minioç™»å½•å¯†ç </p>
<p>dataPathä¸ºæ•°æ®å­˜å‚¨è·¯å¾„</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export MINIO_ACCESS_KEY="minio"</span><br><span class="line">export MINIO_SECRET_KEY="123qwe!@#"</span><br><span class="line">nohup ./minio server --address :9000 $&#123;dataPath&#125; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h3 id="2-1-3-è¿›å…¥é¡µé¢éªŒè¯"><a href="#2-1-3-è¿›å…¥é¡µé¢éªŒè¯" class="headerlink" title="2.1.3 è¿›å…¥é¡µé¢éªŒè¯"></a>2.1.3 è¿›å…¥é¡µé¢éªŒè¯</h3><p>minioé»˜è®¤ç«¯å£ä¸º9000ï¼Œå¯ä»¥ç”¨â€“address å‚æ•°è‡ªå®šä¹‰ã€‚</p>
<h2 id="2-2-é›†ç¾¤éƒ¨ç½²"><a href="#2-2-é›†ç¾¤éƒ¨ç½²" class="headerlink" title="2.2 é›†ç¾¤éƒ¨ç½²"></a>2.2 é›†ç¾¤éƒ¨ç½²</h2><p>MINIOé›†ç¾¤ä¸å¸¸è§„é›†ç¾¤ä¸åŒçš„æ˜¯ï¼ŒMINIOé›†ç¾¤ä¸­å­˜å‚¨çš„æ–‡ä»¶å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå„å­˜ä¸€ä»½ï¼Œè€Œæ˜¯å°†è®²æ–‡ä»¶æ‹†åˆ†æˆå¤šåˆ†ï¼Œå†ä½¿ç”¨<strong>çº åˆ ç æŠ€æœ¯</strong>ä¿éšœå¤šèŠ‚ç‚¹æ–‡ä»¶å®Œæ•´ã€‚åŒæ—¶è¯·<strong>å¯¹æ¯”</strong>é›†ç¾¤éƒ¨ç½²å’Œå•ç‚¹éƒ¨ç½²å¯åŠ¨å‘½ä»¤ã€‚æœ¬æ–‡æ¡£ä»¥å››ä¸ªèŠ‚ç‚¹ä¸ºä¾‹é¢„ç•™5ä¸ªç«¯å£ï¼ˆ8089ã€9001ã€9002ã€9003ã€9004ï¼‰</p>
<h3 id="2-2-1-éé›†ç¾¤å•èŠ‚ç‚¹éƒ¨ç½²"><a href="#2-2-1-éé›†ç¾¤å•èŠ‚ç‚¹éƒ¨ç½²" class="headerlink" title="2.2.1 éé›†ç¾¤å•èŠ‚ç‚¹éƒ¨ç½²"></a>2.2.1 éé›†ç¾¤å•èŠ‚ç‚¹éƒ¨ç½²</h3><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export MINIO_ACCESS_KEY="minio"</span><br><span class="line">export MINIO_SECRET_KEY="123qwe!@#"</span><br><span class="line">nohup ./minio server --address :9000 $&#123;dataPath&#125; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-é›†ç¾¤ä¸‹å•èŠ‚ç‚¹éƒ¨ç½²"><a href="#2-2-2-é›†ç¾¤ä¸‹å•èŠ‚ç‚¹éƒ¨ç½²" class="headerlink" title="2.2.2 é›†ç¾¤ä¸‹å•èŠ‚ç‚¹éƒ¨ç½²"></a>2.2.2 é›†ç¾¤ä¸‹å•èŠ‚ç‚¹éƒ¨ç½²</h3><p>é›†ç¾¤ä¸‹éƒ¨ç½²minioå•èŠ‚ç‚¹éœ€è¦æ ¹æ®éé›†ç¾¤å•èŠ‚ç‚¹éƒ¨ç½²å‘½ä»¤è¿›è¡Œä¿®æ”¹ã€‚å°†datapathéƒ¨åˆ†æŒ‡å‘é›†ç¾¤ä¸­æ‰€æœ‰minioèŠ‚ç‚¹çš„datapathã€‚</p>
<p>é›†ç¾¤ä¸­å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹éƒ¨ç½²å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export MINIO_ACCESS_KEY="minio"</span><br><span class="line">export MINIO_SECRET_KEY="123qwe!@#"</span><br><span class="line">nohup ./minio server --address $&#123;Node1_IP&#125;:$&#123;Node1_Port&#125;  http://$&#123;Node1_IP&#125;/data/data1 http://$&#123;Node2_IP&#125;/data/data2 http://$&#123;Node3_IP&#125;/data/data3 http://$&#123;Node4_IP&#125;/data/data4 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-MINIOé›†ç¾¤æ³¨æ„ç‚¹"><a href="#2-2-3-MINIOé›†ç¾¤æ³¨æ„ç‚¹" class="headerlink" title="2.2.3 MINIOé›†ç¾¤æ³¨æ„ç‚¹"></a>2.2.3 MINIOé›†ç¾¤æ³¨æ„ç‚¹</h3><p>minioçš„é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹çš„<strong>ç™»å½•è´¦æˆ·</strong>åŠ<strong>å¯†ç </strong>å¿…é¡»ä¸€è‡´ã€‚</p>
<p>minioçš„é›†ç¾¤èŠ‚ç‚¹æ•°é‡æ¨èå¤§äºç­‰äº<strong>4</strong>ã€‚</p>
<h3 id="2-2-4-MINIOè´Ÿè½½å‡è¡¡"><a href="#2-2-4-MINIOè´Ÿè½½å‡è¡¡" class="headerlink" title="2.2.4 MINIOè´Ÿè½½å‡è¡¡"></a>2.2.4 MINIOè´Ÿè½½å‡è¡¡</h3><p>å®˜æ–¹æ–‡æ¡£æ”¯æŒnginxï¼Œå¯å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡ã€‚</p>
<h4 id="2-2-4-1-é…ç½®nginxåˆ†å‘ç«¯å£"><a href="#2-2-4-1-é…ç½®nginxåˆ†å‘ç«¯å£" class="headerlink" title="2.2.4.1 é…ç½®nginxåˆ†å‘ç«¯å£"></a>2.2.4.1 é…ç½®nginxåˆ†å‘ç«¯å£</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"> <span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">8089</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  www.dealthBook.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-2-æ·»åŠ upstream"><a href="#2-2-4-2-æ·»åŠ upstream" class="headerlink" title="2.2.4.2 æ·»åŠ upstream"></a>2.2.4.2 æ·»åŠ upstream</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> minio_server &#123;</span><br><span class="line">	<span class="comment">#1ã€è½®è¯¢ï¼ˆé»˜è®¤é€‰é¡¹ï¼Œæ‰€æœ‰weight=1ï¼‰</span></span><br><span class="line">	<span class="comment">#2ã€weightï¼Œæ‰§è¡Œè½®è¯¢å‡ ç‡ï¼Œweightä¸è®¿é—®å‡ ç‡æˆæ­£æ¯”</span></span><br><span class="line">	<span class="comment">#3ã€ip_hashï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§hashç»“æœåˆ†é…ï¼Œè¿™æ ·å…¶å®æ˜¯æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼</span></span><br><span class="line">	<span class="comment">#4ã€least_connï¼Œæœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP1&#125;</span>:<span class="variable">$&#123;PORT1&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP2&#125;</span>:<span class="variable">$&#123;PORT2&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP3&#125;</span>:<span class="variable">$&#123;PORT3&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP4&#125;</span>:<span class="variable">$&#123;PORT4&#125;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-3-æ·»åŠ minioçš„upstreamåç§°"><a href="#2-2-4-3-æ·»åŠ minioçš„upstreamåç§°" class="headerlink" title="2.2.4.3 æ·»åŠ minioçš„upstreamåç§°"></a>2.2.4.3 æ·»åŠ minioçš„upstreamåç§°</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /minio &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://minio_server;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-4-æœ€ç»ˆé…ç½®æ–‡ä»¶å¸ƒå±€"><a href="#2-2-4-4-æœ€ç»ˆé…ç½®æ–‡ä»¶å¸ƒå±€" class="headerlink" title="2.2.4.4 æœ€ç»ˆé…ç½®æ–‡ä»¶å¸ƒå±€"></a>2.2.4.4 æœ€ç»ˆé…ç½®æ–‡ä»¶å¸ƒå±€</h4><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">  	...</span><br><span class="line">    <span class="attribute">upstream</span> minio_server&#123;</span><br><span class="line">		...</span><br><span class="line">    &#125;</span><br><span class="line">    server&#123;</span><br><span class="line">        ...</span><br><span class="line">       	<span class="attribute">location</span> /minio&#123;</span><br><span class="line">            ...</span><br><span class="line">     	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-5-å¯åŠ¨nginxåŠæ‰€æœ‰èŠ‚ç‚¹çš„minio"><a href="#2-2-5-å¯åŠ¨nginxåŠæ‰€æœ‰èŠ‚ç‚¹çš„minio" class="headerlink" title="2.2.5 å¯åŠ¨nginxåŠæ‰€æœ‰èŠ‚ç‚¹çš„minio"></a>2.2.5 å¯åŠ¨nginxåŠæ‰€æœ‰èŠ‚ç‚¹çš„minio</h3><h3 id="2-2-6-éªŒè¯"><a href="#2-2-6-éªŒè¯" class="headerlink" title="2.2.6 éªŒè¯"></a>2.2.6 éªŒè¯</h3><h4 id="2-2-6-1-éªŒè¯å„èŠ‚ç‚¹minioæ˜¯å¦æ­£å¸¸"><a href="#2-2-6-1-éªŒè¯å„èŠ‚ç‚¹minioæ˜¯å¦æ­£å¸¸" class="headerlink" title="2.2.6.1 éªŒè¯å„èŠ‚ç‚¹minioæ˜¯å¦æ­£å¸¸"></a>2.2.6.1 éªŒè¯å„èŠ‚ç‚¹minioæ˜¯å¦æ­£å¸¸</h4><blockquote>
<p>è¿›å…¥ <a href="http://ip:port/minio">http://ip:port/minio</a></p>
</blockquote>
<h4 id="2-2-6-2-é€šè¿‡nginxè¿›å…¥minioæŸ¥çœ‹åˆ†å‘æ˜¯å¦æ­£å¸¸-æœ¬æ–‡é…ç½®nginxçš„minioç«¯å£ä¸º8089"><a href="#2-2-6-2-é€šè¿‡nginxè¿›å…¥minioæŸ¥çœ‹åˆ†å‘æ˜¯å¦æ­£å¸¸-æœ¬æ–‡é…ç½®nginxçš„minioç«¯å£ä¸º8089" class="headerlink" title="2.2.6.2 é€šè¿‡nginxè¿›å…¥minioæŸ¥çœ‹åˆ†å‘æ˜¯å¦æ­£å¸¸,æœ¬æ–‡é…ç½®nginxçš„minioç«¯å£ä¸º8089"></a>2.2.6.2 é€šè¿‡nginxè¿›å…¥minioæŸ¥çœ‹åˆ†å‘æ˜¯å¦æ­£å¸¸,æœ¬æ–‡é…ç½®nginxçš„minioç«¯å£ä¸º8089</h4><blockquote>
<p>é€šè¿‡nginxè¿›å…¥minio <a href="http://ip:8089/minio" target="_blank" rel="noopener">http://ip:8089/minio</a></p>
</blockquote>
<h1 id="3-MinIOé¡µé¢"><a href="#3-MinIOé¡µé¢" class="headerlink" title="3. MinIOé¡µé¢"></a>3. MinIOé¡µé¢</h1><h2 id="3-1-æ–°å»ºæ¡¶ï¼ˆBucketï¼‰åŠä¸Šä¼ æ–‡ä»¶"><a href="#3-1-æ–°å»ºæ¡¶ï¼ˆBucketï¼‰åŠä¸Šä¼ æ–‡ä»¶" class="headerlink" title="3.1 æ–°å»ºæ¡¶ï¼ˆBucketï¼‰åŠä¸Šä¼ æ–‡ä»¶"></a>3.1 æ–°å»ºæ¡¶ï¼ˆBucketï¼‰åŠä¸Šä¼ æ–‡ä»¶</h2><img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/06/29/Minio/MinIO-1.png" alt="MinIO-1.png">]]></content>
      <categories>
        <category>MinIO</category>
      </categories>
      <tags>
        <tag>MinIO</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>å­˜å‚¨</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAçº¿ç¨‹æ± </title>
    <url>/2020/07/02/JAVA%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-äº†è§£çº¿ç¨‹æ± "><a href="#1-äº†è§£çº¿ç¨‹æ± " class="headerlink" title="1.  äº†è§£çº¿ç¨‹æ± "></a>1.  äº†è§£çº¿ç¨‹æ± </h1><p>çº¿ç¨‹æ± ç®€å•ç†è§£å°±æ˜¯ä¸€æ¬¡åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œå½“ä¸€ä¸ªä»»åŠ¡äº¤ç”±çº¿ç¨‹æ± æ‰§è¡Œæ—¶ï¼Œç”±çº¿ç¨‹æ± äº¤ç”±ç®¡ç†çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h1 id="2-çº¿ç¨‹æ± çš„ä¼˜ç‚¹"><a href="#2-çº¿ç¨‹æ± çš„ä¼˜ç‚¹" class="headerlink" title="2. çº¿ç¨‹æ± çš„ä¼˜ç‚¹"></a>2. çº¿ç¨‹æ± çš„ä¼˜ç‚¹</h1><p>ï¼ˆ1ï¼‰ä¸éœ€è¦ä¸»åŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å‡ç”±çº¿ç¨‹æ± ç®¡ç†ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ¶ˆè€—ã€‚</p>
<p>ï¼ˆ2ï¼‰æé«˜å“åº”é€Ÿåº¦ï¼Œéœ€è¦çº¿ç¨‹ç›´æ¥ä½¿ç”¨ï¼Œçœå»äº†åˆ›å»ºæ—¶çš„æ—¶é—´æ¶ˆè€—ã€‚</p>
<p>ï¼ˆ3ï¼‰æ›´æ–¹ä¾¿äºå¹¶å‘ç®¡ç†ã€‚</p>
<h1 id="3-JDKä¸­çº¿ç¨‹æ± ç±»"><a href="#3-JDKä¸­çº¿ç¨‹æ± ç±»" class="headerlink" title="3. JDKä¸­çº¿ç¨‹æ± ç±»"></a>3. JDKä¸­çº¿ç¨‹æ± ç±»</h1><p>è¯´åˆ°çº¿ç¨‹æ± å°±éœ€è¦å»äº†è§£ Executors ï¼Œå®ƒæ˜¯çº¿ç¨‹æ± çš„å·¥å‚ç±»ï¼Œé‡Œé¢å¯¹åº”äº†å››ç§åº”ç”¨åœºæ™¯çš„çº¿ç¨‹æ± ã€‚</p>
<a id="more"></a>

<h2 id="3-1-newFixedThreadPool"><a href="#3-1-newFixedThreadPool" class="headerlink" title="3.1 newFixedThreadPool"></a>3.1 newFixedThreadPool</h2><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± é‡ç”¨åœ¨å…±äº«çš„æ— è¾¹ç•Œé˜Ÿåˆ—ä¸Šè¿è¡Œçš„å›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚</p>
<p><code>å…³é”®å­—</code>  å›ºå®šçº¿ç¨‹æ•°ã€æ— è¾¹ç•Œé˜»å¡é˜Ÿåˆ—</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Executor threadPool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">fixedPool.execute(()-&gt; log.info(<span class="string">"run with fixedPool"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-2-newSingleThreadExecutor"><a href="#3-2-newSingleThreadExecutor" class="headerlink" title="3.2  newSingleThreadExecutor"></a>3.2  newSingleThreadExecutor</h2><p>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¨‹åºï¼Œè¯¥æ‰§è¡Œç¨‹åºä½¿ç”¨åœ¨ä¸å—é™åˆ¶çš„é˜Ÿåˆ—ä¸Šæ“ä½œçš„å•ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p>
<p><code>å…³é”®å­—</code>  å•ä¸ªçº¿ç¨‹ã€æ— è¾¹ç•Œé˜»å¡é˜Ÿåˆ—</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Executor singlePool = Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">singlePool.execute(() -&gt; log.info(<span class="string">"run with singlePool"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-3-newCachedThreadPool"><a href="#3-3-newCachedThreadPool" class="headerlink" title="3.3 newCachedThreadPool"></a>3.3 newCachedThreadPool</h2><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†æ˜¯å°†åœ¨å…ˆå‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶é‡ç”¨å®ƒä»¬ã€‚é€šè¿‡è¿‡æœŸæ—¶é—´è¿›è¡Œå›æ”¶ã€‚</p>
<p><code>å…³é”®å­—</code>  ç¼“å­˜ã€å»¶è¿Ÿé”€æ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Executor cachedPool = Executors.newCachedThreadPool();</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">cachedPool.execute(() -&gt; log.info(<span class="string">"run with cachedPool"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="3-4-newScheduledThreadPool"><a href="#3-4-newScheduledThreadPool" class="headerlink" title="3.4 newScheduledThreadPool"></a>3.4 newScheduledThreadPool</h2><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± å¯ä»¥å®‰æ’å‘½ä»¤åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œæˆ–å®šæœŸæ‰§è¡Œã€‚</p>
<p><code>å…³é”®å­—</code>  å»¶è¿Ÿæ‰§è¡Œã€å»¶è¿Ÿé˜Ÿåˆ—</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Executor scheduledPool = Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line">scheduledPool.execute(() -&gt; log.info(<span class="string">"run with scheduledPool"</span>));</span><br></pre></td></tr></table></figure>

<h1 id="4-è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#4-è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="4. è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>4. è‡ªå®šä¹‰çº¿ç¨‹æ± </h1><p>å¦‚æœå¥½å¥‡è¿›å»çœ‹è¿‡JDKå®šä¹‰çš„å››ç§çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°éƒ½æ˜¯æ–°å»ºçš„ThreadPoolExecutorç±»ï¼Œé€šè¿‡ä¸åŒçš„å‚æ•°å®ç°ä¸åŒçš„åœºæ™¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, <span class="keyword">int</span> maximumPoolSize, <span class="keyword">long</span> keepAliveTime, TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                             BlockingQueue&lt;Runnable&gt; workQueue,  ThreadFactory threadFactory, </span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">                Executors.defaultThreadFactory(), handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">å‚æ•°</th>
<th>å«ä¹‰</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">corePoolSize</td>
<td>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°</td>
<td>corePoolSize â€“ä¿ç•™åœ¨æ± ä¸­çš„çº¿ç¨‹æ•°ï¼ˆå³ä½¿å®ƒä»¬å¤„äºç©ºé—²çŠ¶æ€ï¼‰ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOut</td>
</tr>
<tr>
<td align="left">maximumPoolSize</td>
<td>çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°</td>
<td>æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°</td>
</tr>
<tr>
<td align="left">keepAliveTime</td>
<td>çº¿ç¨‹å­˜æ´»æ—¶é—´</td>
<td>å½“çº¿ç¨‹æ•°å¤§äºå†…æ ¸æ•°æ—¶ï¼Œè¿™æ˜¯å¤šä½™çš„ç©ºé—²çº¿ç¨‹å°†åœ¨ç»ˆæ­¢ä¹‹å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚</td>
</tr>
<tr>
<td align="left">unit</td>
<td>çº¿ç¨‹å­˜æ´»æ—¶é—´å•ä½</td>
<td>keepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½</td>
</tr>
<tr>
<td align="left">workQueue</td>
<td>é˜»å¡é˜Ÿåˆ—</td>
<td>ç”¨äºåœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰ä¿ç•™ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚ æ­¤é˜Ÿåˆ—å°†ä»…ä¿å­˜executeæ–¹æ³•æäº¤çš„Runnableä»»åŠ¡ã€‚</td>
</tr>
<tr>
<td align="left">threadFactory</td>
<td>çº¿ç¨‹å·¥å‚</td>
<td>æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td align="left">handler</td>
<td>çº¿ç¨‹æ± æ‹’ç»ï¼ˆé¥±å’Œï¼‰ç­–ç•¥</td>
<td>ä¸èƒ½ç”±ThreadPoolExecutoræ‰§è¡Œçš„ä»»åŠ¡çš„å¤„ç†ç¨‹åºã€‚é»˜è®¤ä½¿ç”¨AbortPolicyï¼ŒåŠæŠ›å‡ºå¼‚å¸¸ã€‚</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThreadPool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadPoolExecutor pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span></span><br><span class="line">            , TimeUnit.MILLISECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="number">8</span>), Executors.defaultThreadFactory(),</span><br><span class="line">            <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> finalI = i;</span><br><span class="line">            pool.execute(() -&gt; &#123;</span><br><span class="line">                log.info(String.valueOf(finalI));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—è¾“å‡ºå¦‚ä¸‹</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/07/02/JAVA%E7%BA%BF%E7%A8%8B%E6%B1%A0/JAVAçº¿ç¨‹æ± -1.png" alt="JAVAçº¿ç¨‹æ± -1.png">

<br>

]]></content>
      <categories>
        <category>Java</category>
        <category>çº¿ç¨‹æ± </category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>çº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>SPIæœºåˆ¶</title>
    <url>/2020/07/01/SPI%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p><strong>æœ¬blogçš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong></p>
<h1 id="1-ä»€ä¹ˆæ˜¯SPI"><a href="#1-ä»€ä¹ˆæ˜¯SPI" class="headerlink" title="1. ä»€ä¹ˆæ˜¯SPI"></a>1. ä»€ä¹ˆæ˜¯SPI</h1><h2 id="1-1-SPIæ€æƒ³"><a href="#1-1-SPIæ€æƒ³" class="headerlink" title="1.1 SPIæ€æƒ³"></a>1.1 SPIæ€æƒ³</h2><p>SPIçš„å…¨åä¸ºService Provider Interface.è¿™ä¸ªæ˜¯é’ˆå¯¹å‚å•†æˆ–è€…æ’ä»¶çš„ã€‚</p>
<h2 id="1-2-SPIçº¦å®š"><a href="#1-2-SPIçº¦å®š" class="headerlink" title="1.2 SPIçº¦å®š"></a>1.2 SPIçº¦å®š</h2><h3 id="1-2-1-Java"><a href="#1-2-1-Java" class="headerlink" title="1.2.1 Java"></a>1.2.1 Java</h3><p>å½“æœåŠ¡çš„æä¾›è€…ï¼Œæä¾›äº†æœåŠ¡æ¥å£çš„ä¸€ç§å®ç°ä¹‹åï¼Œåœ¨jaråŒ…çš„META-INF/services/ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªä»¥æœåŠ¡æ¥å£å‘½åçš„æ–‡ä»¶ã€‚</p>
<h3 id="1-2-2-Spring"><a href="#1-2-2-Spring" class="headerlink" title="1.2.2 Spring"></a>1.2.2 Spring</h3><p>åœ¨jaråŒ…çš„META-INF/ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªspring.factoriesï¼Œæ‰€æœ‰spiå¯¹åº”å…³ç³»éƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<h1 id="2-Springä¸­çš„SPI"><a href="#2-Springä¸­çš„SPI" class="headerlink" title="2. Springä¸­çš„SPI"></a>2. Springä¸­çš„SPI</h1><blockquote>
<p>æœ¬æ–‡ä»‹ç»ä¸‹springçš„SPI</p>
</blockquote>
<h2 id="2-1-å®šä¹‰ä¸€ä¸ªæ¥å£"><a href="#2-1-å®šä¹‰ä¸€ä¸ªæ¥å£" class="headerlink" title="2.1 å®šä¹‰ä¸€ä¸ªæ¥å£"></a>2.1 å®šä¹‰ä¸€ä¸ªæ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InitServiceInterFace</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">final</span> ApplicationContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="2-2-ç¼–å†™ä¸€ä¸ªæ¥å£çš„å®ç°ç±»"><a href="#2-2-ç¼–å†™ä¸€ä¸ªæ¥å£çš„å®ç°ç±»" class="headerlink" title="2.2 ç¼–å†™ä¸€ä¸ªæ¥å£çš„å®ç°ç±»"></a>2.2 ç¼–å†™ä¸€ä¸ªæ¥å£çš„å®ç°ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.windh.springspi.interfaces.InitServiceInterFace;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogInit</span> <span class="keyword">implements</span> <span class="title">InitServiceInterFace</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ApplicationContext context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO init LogInit</span></span><br><span class="line">        log.info(<span class="string">"Init My Log."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-æ–°å»ºspiæ‰€éœ€é™æ€æ–‡ä»¶"><a href="#2-3-æ–°å»ºspiæ‰€éœ€é™æ€æ–‡ä»¶" class="headerlink" title="2.3 æ–°å»ºspiæ‰€éœ€é™æ€æ–‡ä»¶"></a>2.3 æ–°å»ºspiæ‰€éœ€é™æ€æ–‡ä»¶</h2><blockquote>
<p>åœ¨Resourcesé™æ€èµ„æºç›®å½•ä¸‹æ–°å»ºspring.factoriesæ–‡ä»¶ï¼›å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">com.windh.springspi.interfaces.InitServiceInterFace</span>=<span class="string">\</span></span><br><span class="line">  <span class="attr">com.windh.springspi.impl.LogInit</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-æµ‹è¯•"><a href="#2-4-æµ‹è¯•" class="headerlink" title="2.4 æµ‹è¯•"></a>2.4 æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.windh.springspi.interfaces.InitServiceInterFace;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.SpringFactoriesLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringspiApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext run = SpringApplication.run(SpringspiApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">        List&lt;InitServiceInterFace&gt; serviceLoader = SpringFactoriesLoader.loadFactories(</span><br><span class="line">                InitServiceInterFace<span class="class">.<span class="keyword">class</span>, <span class="title">Thread</span>.<span class="title">currentThread</span>().<span class="title">getContextClassLoader</span>())</span>;</span><br><span class="line">        <span class="keyword">for</span> (InitServiceInterFace initServiceInterFace : serviceLoader) &#123;</span><br><span class="line">            initServiceInterFace.init(run);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—è¾“å…¥å¦‚ä¸‹ï¼š</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/07/01/SPI%E6%9C%BA%E5%88%B6/SPI-1.png" alt="SPI-1.png">]]></content>
      <categories>
        <category>SPI</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
        <tag>SPI</tag>
      </tags>
  </entry>
  <entry>
    <title>Quartz</title>
    <url>/2020/06/28/Quartz/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>Quartzï¼ˆJob Schedulerï¼‰ï¼Œä¸€ä¸ªæ¯”è¾ƒæµè¡Œçš„å®šæ—¶ä»»åŠ¡æ¡†æ¶ã€‚æœç´¢å¼•æ“ä¼šæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><p>JDKï¼š1.8</p>
<p>IDEï¼šIDEA</p>
<p>mavenä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3. è¯¦è§£"></a>3. è¯¦è§£</h1><p>Quartzçš„ä¸Šæ‰‹éš¾åº¦å…¶å®æŒºä½çš„ï¼Œå®ƒä¼šç»™æˆ‘ä»¬æä¾›å¾ˆå¤šç®€å•çš„å®šæ—¶ä»»åŠ¡æ–¹æ³•ã€‚åŒæ—¶ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨cronè¡¨è¾¾å¼è®¾å®šä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼Œæ¥ä¸‹æ¥çš„ä¾‹å­å°±æ˜¯ä½¿ç”¨cronè¡¨è¾¾å¼è¿›è¡Œä»»åŠ¡çš„åˆ›å»ºã€‚cronçš„ç”¨æ³•ä¼šåœ¨åç»­blogä¸­è®²è§£ã€‚</p>
<a id="more"></a>

<h2 id="3-1-åˆ›å»ºå¯¹å¤–å¼€æ”¾çš„ç±»"><a href="#3-1-åˆ›å»ºå¯¹å¤–å¼€æ”¾çš„ç±»" class="headerlink" title="3.1 åˆ›å»ºå¯¹å¤–å¼€æ”¾çš„ç±»"></a>3.1 åˆ›å»ºå¯¹å¤–å¼€æ”¾çš„ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.windh.quartz.job.JobRunnable;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.quartz.impl.StdSchedulerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PreDestroy;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Scheduler SCHEDULER;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Runnable&gt; JOB_KEY_MAP = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadPoolExecutor THREAD_POOL;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">QuartzUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// quartz scheduler</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SCHEDULER = StdSchedulerFactory.getDefaultScheduler();</span><br><span class="line">            <span class="comment">// åŠæ—¶å¯åŠ¨</span></span><br><span class="line">            SCHEDULER.start();</span><br><span class="line">            <span class="comment">// startDelayed(1) ä¸ºå»¶æ—¶å¯åŠ¨ï¼Œå‚æ•°ä¸ºintç±»å‹ï¼Œå•ä½ ç§’</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">            log.error(<span class="string">"Create Default StdScheduler error."</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// threadpool</span></span><br><span class="line">        THREAD_POOL = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">8</span>, <span class="number">64</span>, <span class="number">0</span>, TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue(<span class="number">64</span>), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å‚æ•°è¡¨ç¤º  å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ‰ä¼šç»“æŸscheduler</span></span><br><span class="line">        <span class="keyword">if</span> (SCHEDULER != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SCHEDULER.shutdown(<span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">                log.error(<span class="string">"Shutdown Scheduler error."</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (THREAD_POOL != <span class="keyword">null</span> &amp;&amp; !THREAD_POOL.isShutdown()) &#123;</span><br><span class="line">            THREAD_POOL.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(String cron, Runnable runnable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (runnable != <span class="keyword">null</span> &amp;&amp; CronExpression.isValidExpression(cron)) &#123;</span><br><span class="line">            CronExpression cronExpression;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cronExpression = <span class="keyword">new</span> CronExpression(cron);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                log.error(<span class="string">"parse cron error,add Task error."</span>, e);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            addTask(cronExpression, runnable);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.error(<span class="string">"param invalid, addTask error."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addTask</span><span class="params">(CronExpression cron, Runnable runnable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (runnable == <span class="keyword">null</span> || cron == <span class="keyword">null</span> || !CronExpression.isValidExpression(cron.getCronExpression())) &#123;</span><br><span class="line">            log.error(<span class="string">"param invalid, addTask error."</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String uuid = UUID.randomUUID().toString();</span><br><span class="line">        JobDetail job = JobBuilder.newJob(JobRunnable<span class="class">.<span class="keyword">class</span>).<span class="title">withIdentity</span>(<span class="title">uuid</span>).<span class="title">build</span>()</span>;</span><br><span class="line"></span><br><span class="line">        Trigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .startNow()</span><br><span class="line">                .withIdentity(uuid)</span><br><span class="line">                .withSchedule(CronScheduleBuilder.cronSchedule(cron)).build();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SCHEDULER.scheduleJob(job, trigger);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">            log.error(<span class="string">"ScheduledJob error."</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        JOB_KEY_MAP.put(uuid, runnable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ThreadPoolExecutor <span class="title">getThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> THREAD_POOL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Runnable&gt; <span class="title">getJobKeyMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JOB_KEY_MAP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Scheduler <span class="title">getScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SCHEDULER;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-åˆ›å»ºä¸€ä¸ªå®ç°org-quartz-Jobçš„ç±»JobRunnable"><a href="#3-2-åˆ›å»ºä¸€ä¸ªå®ç°org-quartz-Jobçš„ç±»JobRunnable" class="headerlink" title="3.2 åˆ›å»ºä¸€ä¸ªå®ç°org.quartz.Jobçš„ç±»JobRunnable"></a>3.2 åˆ›å»ºä¸€ä¸ªå®ç°org.quartz.Jobçš„ç±»JobRunnable</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.windh.quartz.common.utils.QuartzUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.quartz.Job;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</span><br><span class="line"><span class="keyword">import</span> org.quartz.JobKey;</span><br><span class="line"><span class="keyword">import</span> org.quartz.SchedulerException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JobRunnable</span> <span class="keyword">implements</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(JobExecutionContext context)</span> </span>&#123;</span><br><span class="line">        JobKey jobKey = context.getJobDetail().getKey();</span><br><span class="line">        <span class="keyword">if</span> (QuartzUtil.getJobKeyMap().containsKey(jobKey.getName())) &#123;</span><br><span class="line">            Runnable runnable = QuartzUtil.getJobKeyMap().get(jobKey.getName());</span><br><span class="line">            QuartzUtil.getThreadPool().execute(runnable);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                QuartzUtil.getScheduler().deleteJob(jobKey);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SchedulerException e) &#123;</span><br><span class="line">                log.error(<span class="string">"Job info is not contain ,Delete Job error."</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-è°ƒç”¨ï¼ŒéªŒè¯æ–¹å¼ä¸ºspringbootå¯åŠ¨åæ·»åŠ scheduledã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨springbootå…¥å£ç±»çš„mainæ–¹æ³•é‡Œç®€å•éªŒè¯ä¸‹"><a href="#3-3-è°ƒç”¨ï¼ŒéªŒè¯æ–¹å¼ä¸ºspringbootå¯åŠ¨åæ·»åŠ scheduledã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨springbootå…¥å£ç±»çš„mainæ–¹æ³•é‡Œç®€å•éªŒè¯ä¸‹" class="headerlink" title="3.3 è°ƒç”¨ï¼ŒéªŒè¯æ–¹å¼ä¸ºspringbootå¯åŠ¨åæ·»åŠ scheduledã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨springbootå…¥å£ç±»çš„mainæ–¹æ³•é‡Œç®€å•éªŒè¯ä¸‹"></a>3.3 è°ƒç”¨ï¼ŒéªŒè¯æ–¹å¼ä¸ºspringbootå¯åŠ¨åæ·»åŠ scheduledã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨springbootå…¥å£ç±»çš„mainæ–¹æ³•é‡Œç®€å•éªŒè¯ä¸‹</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.windh.quartz.common.utils.QuartzUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartWare</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// cronè¡¨è¾¾å¼ 0/2 * * * * ?  è¡¨ç¤ºæ¯åˆ†é’Ÿçš„0ç§’å¼€å§‹æ²¡è¿‡2ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">        QuartzUtil.addTask(<span class="string">"0/2 * * * * ?"</span>, () -&gt; log.info(<span class="string">"0/2 * * * * ? scheduled exec."</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-éªŒè¯æ—¥å¿—"><a href="#3-4-éªŒè¯æ—¥å¿—" class="headerlink" title="3.4 éªŒè¯æ—¥å¿—"></a>3.4 éªŒè¯æ—¥å¿—</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO 3816 --- [pool-1-thread-1] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br><span class="line">INFO 3816 --- [pool-1-thread-2] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br><span class="line">INFO 3816 --- [pool-1-thread-3] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br><span class="line">INFO 3816 --- [pool-1-thread-4] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br><span class="line">INFO 3816 --- [pool-1-thread-5] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br><span class="line">INFO 3816 --- [pool-1-thread-6] c.w.q.common.springawares.StartWare      : 0&#x2F;2 * * * * ? scheduled exec.</span><br></pre></td></tr></table></figure>



<p>åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å…¶å®æœ‰å¾ˆå¤šéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œæ¯”å¦‚quartzå¯¹jobå’Œtriggerçš„nameè¿›è¡Œçš„ä¸€è‡´çš„æ ¡éªŒã€‚ä¹‹æ‰€ä»¥ä¼šå°è£…ä¸€å±‚ï¼Œæ”¹jobä¸ºrunnableï¼Œæ˜¯ä¸ºäº†æ›´æ–¹ä¾¿è°ƒç”¨ï¼ŒåŒ…æ‹¬1.8ä¹‹åèƒ½ä½¿ç”¨lambdaåèƒ½ç›´æ¥æ„å»ºåŒ¿åå†…éƒ¨ç±»ï¼Œå‡å°‘ä¸å¿…è¦çš„ç±»çš„åˆ›å»ºã€‚</p>
<br>

]]></content>
      <categories>
        <category>Quartz</category>
      </categories>
      <tags>
        <tag>Quartz</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx-LoadBalance</title>
    <url>/2020/06/28/Nginx-LoadBalance/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-äº†è§£Nginx"><a href="#1-äº†è§£Nginx" class="headerlink" title="1. äº†è§£Nginx"></a>1. äº†è§£Nginx</h1><p>Nginxï¼Œé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚åå‘ä»£ç†ä½œä¸ºå®ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒçš„ä¼˜ç‚¹åŒ…æ‹¬éšè—çœŸå®æœåŠ¡å™¨ã€æœåŠ¡èšåˆç­‰ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><p>Nginxï¼š nginx version: nginx/1.17.6    </p>
<p>Gccï¼šbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)</p>
<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3.è¯¦è§£"></a>3.è¯¦è§£</h1><p>Nginxçš„å®‰è£…çš„æ€»ç»“ä¼šæ”¾åœ¨åç»­blogæ›´æ–°ï¼Œæ­¤å¤„ä¸åšè¿‡å¤šçš„èµ˜è¿°ã€‚</p>
<h5 id="step1ï¼šå‡†å¤‡ä¸€ä¸ªnginxç¯å¢ƒ"><a href="#step1ï¼šå‡†å¤‡ä¸€ä¸ªnginxç¯å¢ƒ" class="headerlink" title="step1ï¼šå‡†å¤‡ä¸€ä¸ªnginxç¯å¢ƒ."></a><code>step1</code>ï¼šå‡†å¤‡ä¸€ä¸ªnginxç¯å¢ƒ.</h5><h5 id="step2ï¼šæ‰¾åˆ°nginxé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç¼–è¾‘nginx-conf"><a href="#step2ï¼šæ‰¾åˆ°nginxé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç¼–è¾‘nginx-conf" class="headerlink" title="step2ï¼šæ‰¾åˆ°nginxé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç¼–è¾‘nginx.conf"></a><code>step2</code>ï¼šæ‰¾åˆ°nginxé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç¼–è¾‘nginx.conf</h5><h5 id="step3ï¼šnginx-confä¸­çš„httpä¸­æ·»åŠ -upstreamï¼Œå¦‚ä¸‹"><a href="#step3ï¼šnginx-confä¸­çš„httpä¸­æ·»åŠ -upstreamï¼Œå¦‚ä¸‹" class="headerlink" title="step3ï¼šnginx.confä¸­çš„httpä¸­æ·»åŠ  upstreamï¼Œå¦‚ä¸‹"></a><code>step3</code>ï¼šnginx.confä¸­çš„httpä¸­æ·»åŠ  upstreamï¼Œå¦‚ä¸‹</h5><a id="more"></a>

<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span> servername &#123;</span><br><span class="line">    <span class="comment">#1ã€è½®è¯¢ï¼ˆé»˜è®¤é€‰é¡¹ï¼Œæ‰€æœ‰weight=1ï¼‰</span></span><br><span class="line">    <span class="comment">#2ã€weightï¼Œæ‰§è¡Œè½®è¯¢å‡ ç‡ï¼Œweightä¸è®¿é—®å‡ ç‡æˆæ­£æ¯”</span></span><br><span class="line">    <span class="comment">#3ã€ip_hashï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§hashç»“æœåˆ†é…ï¼Œè¿™æ ·å…¶å®æ˜¯æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼</span></span><br><span class="line">    <span class="comment">#4ã€least_connï¼Œæœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP1&#125;</span>:<span class="variable">$&#123;PORT1&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP2&#125;</span>:<span class="variable">$&#123;PORT2&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP3&#125;</span>:<span class="variable">$&#123;PORT3&#125;</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="variable">$&#123;IP4&#125;</span>:<span class="variable">$&#123;PORT4&#125;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="step4ï¼šnginx-confä¸­çš„serverä¸­æ·»åŠ -location"><a href="#step4ï¼šnginx-confä¸­çš„serverä¸­æ·»åŠ -location" class="headerlink" title="step4ï¼šnginx.confä¸­çš„serverä¸­æ·»åŠ  location"></a><code>step4</code>ï¼šnginx.confä¸­çš„serverä¸­æ·»åŠ  location</h5><p>åœ¨serverä¸­listen ä¸ºå¯¹å¤–æš´éœ²çš„nginxç«¯å£ã€‚</p>
<p>locationä¸­çš„proxy_pass æŒ‡å‘step3ä¸­æ·»åŠ çš„upstream</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /minio &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://servername;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="step5ï¼šæœ€ç»ˆæ•ˆæœå¦‚ä¸‹"><a href="#step5ï¼šæœ€ç»ˆæ•ˆæœå¦‚ä¸‹" class="headerlink" title="step5ï¼šæœ€ç»ˆæ•ˆæœå¦‚ä¸‹"></a><code>step5</code>ï¼šæœ€ç»ˆæ•ˆæœå¦‚ä¸‹</h5><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">    <span class="comment">#                  '$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">    <span class="comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line">    <span class="attribute">upstream</span> servername &#123;</span><br><span class="line">        <span class="comment">#1ã€è½®è¯¢ï¼ˆé»˜è®¤é€‰é¡¹ï¼Œæ‰€æœ‰weight=1ï¼‰</span></span><br><span class="line">        <span class="comment">#2ã€weightï¼Œæ‰§è¡Œè½®è¯¢å‡ ç‡ï¼Œweightä¸è®¿é—®å‡ ç‡æˆæ­£æ¯”</span></span><br><span class="line">        <span class="comment">#3ã€ip_hashï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰ç…§hashç»“æœåˆ†é…ï¼Œè¿™æ ·å…¶å®æ˜¯æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼</span></span><br><span class="line">        <span class="comment">#4ã€least_connï¼Œæœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡</span></span><br><span class="line">        <span class="attribute">server</span> <span class="variable">$&#123;IP1&#125;</span>:<span class="variable">$&#123;PORT1&#125;</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="variable">$&#123;IP2&#125;</span>:<span class="variable">$&#123;PORT2&#125;</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="variable">$&#123;IP3&#125;</span>:<span class="variable">$&#123;PORT3&#125;</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="variable">$&#123;IP4&#125;</span>:<span class="variable">$&#123;PORT4&#125;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#include /usr/local/nginx/minio.conf    </span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8089</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="attribute">location</span> /minio &#123;</span><br><span class="line">			<span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">			<span class="attribute">proxy_pass</span> http://servername;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nginx</category>
        <category>LoadBalance</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>LoadBalance</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo Hello World</title>
    <url>/2020/05/25/Hexo-hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<a id="more"></a>

<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hello World</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot-Build-MyBatis</title>
    <url>/2020/05/28/SpringBoot-Build-MyBatis/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬blogçš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚</strong></p>
</blockquote>
<h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p>SpringBootä¸­ä½¿ç”¨Mybatisä¹‹å‰ï¼Œå…ˆæ­å»ºåŸºæœ¬çš„é¡¹ç›®,ç„¶åå¼•å…¥<a href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter" target="_blank" rel="noopener"><a href="https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter" target="_blank" rel="noopener">mybatis-spring-boot-starter</a></a>å’Œæ•°æ®åº“é©±åŠ¨ï¼ˆæœ¬æ–‡ä½¿ç”¨MySqlï¼‰çš„ä¾èµ–ã€‚ä¹Ÿå¯ä»¥æ·»åŠ druidçš„ä¾èµ–ã€‚</p>
<h2 id="äºŒã€ç¯å¢ƒåŠä¾èµ–"><a href="#äºŒã€ç¯å¢ƒåŠä¾èµ–" class="headerlink" title="äºŒã€ç¯å¢ƒåŠä¾èµ–"></a>äºŒã€ç¯å¢ƒåŠä¾èµ–</h2><p>1ï¼‰JDKï¼š1.8<br>2ï¼‰IDEï¼šIDEA<br>3ï¼‰mavenä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="ä¸‰ã€å®è·µ"><a href="#ä¸‰ã€å®è·µ" class="headerlink" title="ä¸‰ã€å®è·µ"></a>ä¸‰ã€å®è·µ</h2><h4 id="1-æ–°å»ºè¡¨ï¼Œæ­¤å¤„è‡ªå·±éšæ„æ–°å»ºä¸€ä¸ªè¡¨ã€‚åªéœ€è¦å‡ ä¸ªå­—æ®µå³å¯ã€‚éšä¾¿æ’å…¥ä¸¤æ¡æ•°æ®ã€‚"><a href="#1-æ–°å»ºè¡¨ï¼Œæ­¤å¤„è‡ªå·±éšæ„æ–°å»ºä¸€ä¸ªè¡¨ã€‚åªéœ€è¦å‡ ä¸ªå­—æ®µå³å¯ã€‚éšä¾¿æ’å…¥ä¸¤æ¡æ•°æ®ã€‚" class="headerlink" title="1. æ–°å»ºè¡¨ï¼Œæ­¤å¤„è‡ªå·±éšæ„æ–°å»ºä¸€ä¸ªè¡¨ã€‚åªéœ€è¦å‡ ä¸ªå­—æ®µå³å¯ã€‚éšä¾¿æ’å…¥ä¸¤æ¡æ•°æ®ã€‚"></a>1. æ–°å»ºè¡¨ï¼Œæ­¤å¤„è‡ªå·±éšæ„æ–°å»ºä¸€ä¸ªè¡¨ã€‚åªéœ€è¦å‡ ä¸ªå­—æ®µå³å¯ã€‚éšä¾¿æ’å…¥ä¸¤æ¡æ•°æ®ã€‚</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`mybatis`</span>.<span class="string">`t_user`</span>(<span class="string">`id`</span>, <span class="string">`username`</span>, <span class="string">`password`</span>) <span class="keyword">VALUES</span> (<span class="string">'a3fa40d2-978d-4945-b506-077762e99c24'</span>, <span class="string">'user1'</span>, <span class="string">'68a45fe6-abd0-4b17-8809-2ba3026e9718'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`mybatis`</span>.<span class="string">`t_user`</span>(<span class="string">`id`</span>, <span class="string">`username`</span>, <span class="string">`password`</span>) <span class="keyword">VALUES</span> (<span class="string">'ad2b8b5c-5b5b-4247-aadf-80032b4e570f'</span>, <span class="string">'user2'</span>, <span class="string">'ba511205-e163-4194-9ffe-3e42465c1790'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-æ–°å»ºModel"><a href="#2-æ–°å»ºModel" class="headerlink" title="2. æ–°å»ºModel"></a>2. æ–°å»ºModel</h4><blockquote>
<p>é¡¹ç›®é‡Œæ·»åŠ äº†lombokçš„ä¾èµ–ï¼Œå¯ä»¥å…å»getter/setterã€æ„é€ å‡½æ•°ç­‰ã€‚ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Controllerï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£"><a href="#3-Controllerï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£" class="headerlink" title="3. Controllerï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£"></a>3. Controllerï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.windh.mybatis.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.model.UserModel;</span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="comment">// è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œ@RestControllerå¯ä»¥å†™å…¥ä¸€ä¸ªå€¼ï¼Œä½†è¿™ä¸ªå€¼ä¸æ˜¯ç”¨æ¥å®šä¹‰RequestMappingçš„valueçš„ï¼Œè€Œæ˜¯å®šä¹‰controlleråœ¨springå®¹å™¨é‡Œçš„åå­—</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userServiceImpl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserModel <span class="title">getUser</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> String id) </span>&#123;</span><br><span class="line">        UserModel userModel = userServiceImpl.queryUserById(id);</span><br><span class="line">        log.info(<span class="string">"query user info is :&#123;&#125;"</span>, userModel);</span><br><span class="line">        <span class="keyword">return</span> userModel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-Service"><a href="#4-Service" class="headerlink" title="4. Service"></a>4. Service</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¥å£</span></span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.model.UserModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    <span class="function">UserModel <span class="title">queryUserById</span><span class="params">(String id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// impl</span></span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.mapper.user.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.model.UserModel;</span><br><span class="line"><span class="keyword">import</span> com.windh.mybatis.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span>(value = <span class="string">"userServiceImpl"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserModel <span class="title">queryUserById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-Dao-Mybatisæ¥å£"><a href="#5-Dao-Mybatisæ¥å£" class="headerlink" title="5. Dao-Mybatisæ¥å£"></a>5. Dao-Mybatisæ¥å£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.windh.mybatis.model.UserModel;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">UserModel <span class="title">queryUserById</span><span class="params">(@Param(<span class="string">"id"</span>)</span> String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="6ï¼‰Dao-MybatisXml"><a href="#6ï¼‰Dao-MybatisXml" class="headerlink" title="6ï¼‰Dao-MybatisXml"></a>6ï¼‰Dao-MybatisXml</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.windh.mybatis.mapper.user.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span> = <span class="string">"queryUserById"</span> <span class="attr">resultType</span>=<span class="string">"com.windh.mybatis.model.UserModel"</span>&gt;</span></span><br><span class="line">        select * from  mybatis.t_user where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="7-Dao-Mybatisæ¥å£æ‰«æè·¯å¾„"><a href="#7-Dao-Mybatisæ¥å£æ‰«æè·¯å¾„" class="headerlink" title="7. Dao-Mybatisæ¥å£æ‰«æè·¯å¾„"></a>7. Dao-Mybatisæ¥å£æ‰«æè·¯å¾„</h4><blockquote>
<p>åœ¨SpringBootå…¥å£ç±»æ·»åŠ æ³¨è§£ï¼ŒæŒ‡å®šæ¥å£åŒ…ã€‚æ­¤å¤„mapperscançš„è·¯å¾„è¶Šç²¾ç»†è¶Šå¥½ï¼Œå¯¹äºæ³¨å…¥ä¸€ä¸ªæ¥å£çš„å¤šä¸ªå®ç°æ—¶å¯ä»¥è¿‡æ»¤æ‰édaoå±‚çš„æ¥å£ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.windh.mybatis.mapper"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="8-Dao-MybatisXmlæ‰«æè·¯å¾„"><a href="#8-Dao-MybatisXmlæ‰«æè·¯å¾„" class="headerlink" title="8. Dao-MybatisXmlæ‰«æè·¯å¾„"></a>8. Dao-MybatisXmlæ‰«æè·¯å¾„</h4><blockquote>
<p>å…¶å®xmlæ‰«ææ˜¯æœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦æ³¨æ„çš„ã€‚æ ¹æ®é¡¹ç›®æƒ…å†µå®šä¹‰æ‰«æè·¯å¾„ï¼Œåˆ†ä¸€ä¸‹ä¸¤ç§æƒ…å†µã€‚</p>
</blockquote>
<h5 id="1-xmlæ–‡ä»¶æ”¾åœ¨resourceså†…"><a href="#1-xmlæ–‡ä»¶æ”¾åœ¨resourceså†…" class="headerlink" title="(1)xmlæ–‡ä»¶æ”¾åœ¨resourceså†…."></a>(1)xmlæ–‡ä»¶æ”¾åœ¨resourceså†….</h5><blockquote>
<p>æœ¬æ–‡å°±æ˜¯ç”¨è¿™ç§æ–¹å¼çš„ã€‚å°†xmlæ–‡ä»¶æ”¾åœ¨resources/mapperä¸­ã€‚yamlæ–‡ä»¶ä¸­æ·»åŠ mapper-locationsé…ç½®ï¼ŒæŒ‡å®šxmlè·¯å¾„ã€‚</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>

<h5 id="2-xmlæ–‡ä»¶æ”¾åœ¨å’Œâ€œDao-Mybatisæ¥å£â€æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹"><a href="#2-xmlæ–‡ä»¶æ”¾åœ¨å’Œâ€œDao-Mybatisæ¥å£â€æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹" class="headerlink" title="(2)xmlæ–‡ä»¶æ”¾åœ¨å’Œâ€œDao-Mybatisæ¥å£â€æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹"></a>(2)xmlæ–‡ä»¶æ”¾åœ¨å’Œâ€œDao-Mybatisæ¥å£â€æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹</h5><blockquote>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦é…ç½®mapper-locationsäº†ã€‚ä½†æ˜¯SpringBootä¼šæ— æ³•æ‰«æjavaç›®å½•ä¸‹çš„xmlæ–‡ä»¶ï¼Œéœ€è¦åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹build.resourcesé…ç½®ã€‚</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ç¼–è¯‘ src/main/java ç›®å½•ä¸‹çš„ mapper æ–‡ä»¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-å…¥å£ç±»"><a href="#9-å…¥å£ç±»" class="headerlink" title="9. å…¥å£ç±»"></a>9. å…¥å£ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.windh.mybatis.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-yamlæ–‡ä»¶"><a href="#10-yamlæ–‡ä»¶" class="headerlink" title="10. yamlæ–‡ä»¶"></a>10. yamlæ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">&#123;username&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&#123;password&#125;</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://&#123;ip&#125;:&#123;port&#125;/&#123;dbName&#125;?useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">mapper/**/*.xml</span></span><br></pre></td></tr></table></figure>

<h4 id="11-éªŒè¯"><a href="#11-éªŒè¯" class="headerlink" title="11. éªŒè¯"></a>11. éªŒè¯</h4><blockquote>
<p>è®¿é—® <a href="http://localhost:8080/user/a3fa40d2-978d-4945-b506-077762e99c24" target="_blank" rel="noopener">http://localhost:8080/user/a3fa40d2-978d-4945-b506-077762e99c24</a> éªŒè¯</p>
</blockquote>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/28/SpringBoot-Build-MyBatis/SpringBootä¸­æ­å»ºMyBatis-1.png" alt="SpringBootä¸­æ­å»ºMyBatis-1.png">



<p>Mybatisåœ¨SSMæ¡†æ¶æ€»æ˜¯å¿…é¡»æŒæ¡çš„ã€‚å¾ˆå¤šé…ç½®éœ€è¦é‡ç‚¹å…³æ³¨ã€‚å…³äºpomä¸­å¼•å…¥äº†druidï¼Œæ­¤å¤„æä¾›ç›¸å…³æ–‡ç« é“¾<br>æ¥ï¼Œå¯ä»¥ç®€å•äº†è§£ã€‚</p>
<br>

]]></content>
      <categories>
        <category>Java</category>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot-Build</title>
    <url>/2020/05/27/SpringBoot-Build/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>SpringBootæ˜¯å¾®æœåŠ¡åŸºç¡€ï¼Œæ­¤æ–‡è®²è¿°æ­å»ºSpringBootæ–¹å¼ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><p>JDK1.8ã€IDEA</p>
<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3. è¯¦è§£"></a>3. è¯¦è§£</h1><h2 id="3-1-éæ¶‰å¯†ç½‘ç»œç¯å¢ƒ"><a href="#3-1-éæ¶‰å¯†ç½‘ç»œç¯å¢ƒ" class="headerlink" title="3.1 éæ¶‰å¯†ç½‘ç»œç¯å¢ƒ"></a>3.1 éæ¶‰å¯†ç½‘ç»œç¯å¢ƒ</h2><p>è¿™é‡Œçš„éæ¶‰å¯†ç½‘ç»œç¯å¢ƒçš„ç‰¹ç‚¹æ˜¯èƒ½è®¿é—®<a href="https://start.spring.io" target="_blank" rel="noopener">https://start.spring.io</a>ã€‚æ­¤ç½‘å€æ˜¯springå®˜æ–¹æä¾›çš„å¿«é€Ÿæ­å»ºSpringBooté¡¹ç›®çš„å·¥å…·ã€‚åŒ…æ‹¬IDEAä¸­åˆ›å»ºSpringBooté¡¹ç›®ä¹Ÿæ˜¯é€šè¿‡æ­¤å·¥å…·å®ç°ã€‚æœ¬æ–‡ä½¿ç”¨IDEAåˆ›å»ºã€‚</p>
<a id="more"></a>

<h3 id="3-1-1-æ–°å»ºé¡¹ç›®"><a href="#3-1-1-æ–°å»ºé¡¹ç›®" class="headerlink" title="3.1.1 æ–°å»ºé¡¹ç›®"></a>3.1.1 æ–°å»ºé¡¹ç›®</h3><p>IDEA-&gt;File-&gt;New-&gt;Projectâ€¦</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/27/SpringBoot-Build/SpringBootBuild-1.png" alt="SpringBootBuild-1.png">

<h3 id="3-1-2-é€‰æ‹©Spring-Initializr"><a href="#3-1-2-é€‰æ‹©Spring-Initializr" class="headerlink" title="3.1.2 é€‰æ‹©Spring Initializr"></a>3.1.2 é€‰æ‹©Spring Initializr</h3><p>æ­¤å¤„é…ç½®è‡ªå·±çš„JDKç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤çš„Initializr Service URL</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/27/SpringBoot-Build/SpringBootBuild-2.png" alt="SpringBootBuild-2.png">

<h3 id="3-1-3-é…ç½®mavenä¿¡æ¯ï¼Œæ ¹æ®é¡¹ç›®ä¿¡æ¯å¡«å†™"><a href="#3-1-3-é…ç½®mavenä¿¡æ¯ï¼Œæ ¹æ®é¡¹ç›®ä¿¡æ¯å¡«å†™" class="headerlink" title="3.1.3 é…ç½®mavenä¿¡æ¯ï¼Œæ ¹æ®é¡¹ç›®ä¿¡æ¯å¡«å†™"></a>3.1.3 é…ç½®mavenä¿¡æ¯ï¼Œæ ¹æ®é¡¹ç›®ä¿¡æ¯å¡«å†™</h3><img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/27/SpringBoot-Build/SpringBootBuild-3.png" alt="SpringBootBuild-3.png">

<h3 id="3-1-4æ·»åŠ é¡¹ç›®æ‰€éœ€ä¾èµ–starter-gt-Next"><a href="#3-1-4æ·»åŠ é¡¹ç›®æ‰€éœ€ä¾èµ–starter-gt-Next" class="headerlink" title="3.1.4æ·»åŠ é¡¹ç›®æ‰€éœ€ä¾èµ–starter-&gt;Next"></a>3.1.4æ·»åŠ é¡¹ç›®æ‰€éœ€ä¾èµ–starter-&gt;Next</h3><p>æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œå¯ä»¥åªé€‰æ‹©starter-webï¼Œæ•°æ®åº“çš„starteréœ€è¦æ·»åŠ æ•°æ®åº“è¿æ¥é…ç½®ï¼Œå¦åˆ™å¯åŠ¨å¤±è´¥ã€‚</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/27/SpringBoot-Build/SpringBootBuild-4.png" alt="SpringBootBuild-4.png">

<br>

<!-- more -->

<h2 id="3-2-æ¶‰å¯†ç½‘ç»œç¯å¢ƒ"><a href="#3-2-æ¶‰å¯†ç½‘ç»œç¯å¢ƒ" class="headerlink" title="3.2 æ¶‰å¯†ç½‘ç»œç¯å¢ƒ"></a>3.2 æ¶‰å¯†ç½‘ç»œç¯å¢ƒ</h2><p>æ­¤å¤„æ¶‰å¯†ç½‘ç»œç¯å¢ƒæŒ‡ä¸èƒ½è®¿é—®<a href="https://start.spring.io" target="_blank" rel="noopener">https://start.spring.io</a>ã€‚</p>
<h3 id="3-2-1-æ–°å»ºmavené¡¹ç›®"><a href="#3-2-1-æ–°å»ºmavené¡¹ç›®" class="headerlink" title="3.2.1 æ–°å»ºmavené¡¹ç›®"></a>3.2.1 æ–°å»ºmavené¡¹ç›®</h3><img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/05/27/SpringBoot-Build/SpringBootBuild-5.png" alt="SpringBootBuild-5.png">

<h3 id="3-2-2-æ·»åŠ çˆ¶é¡¹ç›®"><a href="#3-2-2-æ·»åŠ çˆ¶é¡¹ç›®" class="headerlink" title="3.2.2 æ·»åŠ çˆ¶é¡¹ç›®"></a>3.2.2 æ·»åŠ çˆ¶é¡¹ç›®</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-æ·»åŠ mavenä¾èµ–ï¼ŒåŒ…å«ssmæ¡†æ¶starter"><a href="#3-2-3-æ·»åŠ mavenä¾èµ–ï¼ŒåŒ…å«ssmæ¡†æ¶starter" class="headerlink" title="3.2.3 æ·»åŠ mavenä¾èµ–ï¼ŒåŒ…å«ssmæ¡†æ¶starter"></a>3.2.3 æ·»åŠ mavenä¾èµ–ï¼ŒåŒ…å«ssmæ¡†æ¶starter</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-æ·»åŠ æ‰“åŒ…æ’ä»¶"><a href="#3-2-4-æ·»åŠ æ‰“åŒ…æ’ä»¶" class="headerlink" title="3.2.4 æ·»åŠ æ‰“åŒ…æ’ä»¶"></a>3.2.4 æ·»åŠ æ‰“åŒ…æ’ä»¶</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- ç¼–è¯‘ src/main/java ç›®å½•ä¸‹çš„ mapper æ–‡ä»¶ --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-5-æ·»åŠ å¯åŠ¨ç±»"><a href="#3-2-5-æ·»åŠ å¯åŠ¨ç±»" class="headerlink" title="3.2.5 æ·»åŠ å¯åŠ¨ç±»"></a>3.2.5 æ·»åŠ å¯åŠ¨ç±»</h3><p>åœ¨javaç›®å½•ä¸‹æ·»åŠ javaç±»ï¼Œæ·»åŠ springbootä¸»å…¥å£æ–¹æ³•ï¼Œç¤ºä¾‹è·¯å¾„ï¼šcom.windh.maven.springboot.Application.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-6-æ·»åŠ springbootå…¥å£ç±»æ³¨è§£"><a href="#3-2-6-æ·»åŠ springbootå…¥å£ç±»æ³¨è§£" class="headerlink" title="3.2.6 æ·»åŠ springbootå…¥å£ç±»æ³¨è§£"></a>3.2.6 æ·»åŠ springbootå…¥å£ç±»æ³¨è§£</h3><p>åœ¨Application.javaç±»ä¸Šæ·»åŠ @SpringBootApplicationæ³¨è§£ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SpringBootä¸»è¦çš„ç‰¹ç‚¹æ˜¯é¡¹ç›®æ„å»ºå¿«ã€‚å‡ ä¹å¯ä»¥åšåˆ°é›¶é…ç½®å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªwebé¡¹ç›®ã€‚ä»å¼€å§‹æ„å»ºåˆ°å¯åŠ¨é¡¹ç›®ï¼Œ1~2åˆ†é’Ÿå°±å¯ä»¥å®Œæˆã€‚</p>
<br>

]]></content>
      <categories>
        <category>Java</category>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>SpringBoot</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨GitHub Actionè‡ªåŠ¨åŒæ­¥ä»£ç åˆ°Gitee</title>
    <url>/2020/08/19/%E4%BD%BF%E7%94%A8GitHub%20Action%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%88%B0Gitee/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬blogçš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡å‡ºã€‚</strong></p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>åœ¨ä»£ç æ‰˜ç®¡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦å°†GitHubçš„ä»£ç åŒæ­¥åˆ°å…¶ä»–æ‰˜ç®¡å¹³å°(Giteeã€GitLabç­‰)çš„éœ€æ±‚ã€‚ä¸»è¦å…³ç³»æ˜¯ï¼šä»¥GiHubä¸ºä¸»ä»“ï¼Œå¹¶ä¸”å®šæœŸè‡ªåŠ¨åŒæ­¥åˆ°Giteeä½œä¸ºé•œåƒä»“åº“ã€‚GitHub PagesåŠGitee Pagesè‡ªåŠ¨æ›´æ–°éƒ¨ç½²ã€‚</p>
<h1 id="2-æ–¹æ¡ˆ"><a href="#2-æ–¹æ¡ˆ" class="headerlink" title="2. æ–¹æ¡ˆ"></a>2. æ–¹æ¡ˆ</h1><h2 id="2-1-Giteeæ‰‹åŠ¨åŒæ­¥"><a href="#2-1-Giteeæ‰‹åŠ¨åŒæ­¥" class="headerlink" title="2.1 Giteeæ‰‹åŠ¨åŒæ­¥"></a>2.1 Giteeæ‰‹åŠ¨åŒæ­¥</h2><p>Giteeæœ¬èº«æ˜¯æä¾›äº†å…¶ä»–å¹³å°ä»“åº“ç»‘å®šåŠç»‘å®šä»“åº“åŒæ­¥çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯å¯ä»¥æ»¡è¶³éœ€æ±‚çš„ã€‚<strong>ä½†æ˜¯</strong>ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œèƒ½è‡ªåŠ¨å®Œæˆçš„äº‹æƒ…åšå†³ä¸é äººåŠ›å»å®Œæˆã€‚è€Œä¸”å¦‚æœä¸€ä¸ªç»„ç»‡ä¸‹å‘å±•åˆ°äº†å‡ ç™¾ä¸Šåƒä¸ªä»“åº“åï¼Œæ‰‹åŠ¨åŒæ­¥çš„ç¼ºé™·å°±ååˆ†æ˜æ˜¾äº†ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æŸç§è®¡ç®—æœºèµ„æº<strong>è‡ªåŠ¨çš„å®ŒæˆåŒæ­¥æ“ä½œ</strong>ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆæ’é™¤ã€‚</p>
<h2 id="2-2-GitHub-Action"><a href="#2-2-GitHub-Action" class="headerlink" title="2.2 GitHub Action"></a>2.2 GitHub Action</h2><p>å…¶å®GitHub Actionæ˜¯GitHubçš„æŒç»­é›†æˆæœåŠ¡ã€‚å®ƒèƒ½å¤Ÿåœ¨æŒ‡å®šæ“ä½œæ—¶è§¦å‘è„šæœ¬åŠŸèƒ½ã€‚å°±é€‰è¿™ä¸ªæ–¹æ¡ˆäº†ã€‚GitHub Actionçš„åŠŸèƒ½æ˜¯å¾ˆå¼ºå¤§çš„ã€‚å…³äºGiHub Actionçš„è¯¦ç»†å†…å®¹å¯ä»¥çœ‹<a href="https://github.com/features/actions" target="_blank" rel="noopener">GitHub Actionå®˜ç½‘</a>ã€‚</p>
<blockquote>
<p>æŒç»­é›†æˆåœ¨é¡¹ç›®ä¸­æœ‰ç€å¾ˆé‡è¦çš„åœ°ä½ï¼Œæ¨èå­¦ä¹ ä¸‹ã€‚</p>
</blockquote>
<h1 id="3-å…·ä½“æ“ä½œ"><a href="#3-å…·ä½“æ“ä½œ" class="headerlink" title="3. å…·ä½“æ“ä½œ"></a>3. å…·ä½“æ“ä½œ</h1><h2 id="3-1-å‡†å¤‡å·¥ä½œ"><a href="#3-1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.1 å‡†å¤‡å·¥ä½œ"></a>3.1 å‡†å¤‡å·¥ä½œ</h2><h3 id="3-1-1-Githubå’ŒGiteeçš„é‚®ç®±ç»‘å®š"><a href="#3-1-1-Githubå’ŒGiteeçš„é‚®ç®±ç»‘å®š" class="headerlink" title="3.1.1 Githubå’ŒGiteeçš„é‚®ç®±ç»‘å®š"></a>3.1.1 Githubå’ŒGiteeçš„é‚®ç®±ç»‘å®š</h3><p>ä»£ç æ‰˜ç®¡å¹³å°çš„é‚®ç®±åœ¨è¿™é‡Œå…¶å®å¾ˆé‡è¦ï¼Œæˆ‘åœ¨è¿™é‡Œè¸©è¿‡ä¸€ä¸ªå‘ã€‚é‚®ç®±å…³ç³»åˆ°sshå…¬é’¥ç§é’¥ã€‚<strong>æ¨èæ‰€æœ‰æ‰˜ç®¡å¹³å°çš„é‚®ç®±ç»Ÿä¸€ã€‚</strong></p>
<h3 id="3-1-2-æ ¹æ®æ‰˜ç®¡å¹³å°çš„é‚®ç®±ç”Ÿæˆsshçš„å…¬é’¥ç§é’¥"><a href="#3-1-2-æ ¹æ®æ‰˜ç®¡å¹³å°çš„é‚®ç®±ç”Ÿæˆsshçš„å…¬é’¥ç§é’¥" class="headerlink" title="3.1.2 æ ¹æ®æ‰˜ç®¡å¹³å°çš„é‚®ç®±ç”Ÿæˆsshçš„å…¬é’¥ç§é’¥"></a>3.1.2 æ ¹æ®æ‰˜ç®¡å¹³å°çš„é‚®ç®±ç”Ÿæˆsshçš„å…¬é’¥ç§é’¥</h3><blockquote>
<p>git bash ä¸­æ•²å…¥å‘½ä»¤ ä¼šåœ¨ <code>~/.ssh</code> æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ <code>id_rsa.pub</code> æ–‡ä»¶å’Œ <code>id_rsa</code> æ–‡ä»¶ï¼Œåˆ†åˆ«å­˜æ”¾å…¬é’¥å’Œç§é’¥ </p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh<span class="literal">-keygen</span> <span class="literal">-t</span> rsa <span class="literal">-C</span> <span class="string">"user@email.com"</span></span><br></pre></td></tr></table></figure>



<h2 id="3-2-å°†å…¬é’¥æ·»åŠ åˆ°Gitee"><a href="#3-2-å°†å…¬é’¥æ·»åŠ åˆ°Gitee" class="headerlink" title="3.2 å°†å…¬é’¥æ·»åŠ åˆ°Gitee"></a>3.2 å°†å…¬é’¥æ·»åŠ åˆ°Gitee</h2><blockquote>
<p>Giteeï¼š[è®¾ç½®] -&gt; [å®‰å…¨è®¾ç½®] -&gt; [SSHå…¬é’¥]</p>
</blockquote>
<h2 id="3-3-å°†ç§é’¥æ·»åŠ åˆ°GitHubä¸­éœ€è¦å¤‡ä»½çš„ä»“åº“çš„Secretsä¸­"><a href="#3-3-å°†ç§é’¥æ·»åŠ åˆ°GitHubä¸­éœ€è¦å¤‡ä»½çš„ä»“åº“çš„Secretsä¸­" class="headerlink" title="3.3 å°†ç§é’¥æ·»åŠ åˆ°GitHubä¸­éœ€è¦å¤‡ä»½çš„ä»“åº“çš„Secretsä¸­"></a>3.3 å°†ç§é’¥æ·»åŠ åˆ°GitHubä¸­éœ€è¦å¤‡ä»½çš„ä»“åº“çš„Secretsä¸­</h2><blockquote>
<p>GitHub Repository -&gt; [Settings] -&gt; [Secrets]</p>
</blockquote>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/08/19/%E4%BD%BF%E7%94%A8GitHub%20Action%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%88%B0Gitee/GitHubAction-1.png" alt="GitHubAction-1.png">

<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/08/19/%E4%BD%BF%E7%94%A8GitHub%20Action%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%88%B0Gitee/GitHubAction-2.png" alt="GitHubAction-2.png">

<p><strong>è®°ä½Nameçš„å€¼ï¼Œå°†ç§é’¥å¡«å…¥Valueä¸­ã€‚</strong></p>
<h2 id="3-4-é…ç½®GitHub-Actionæ–‡ä»¶"><a href="#3-4-é…ç½®GitHub-Actionæ–‡ä»¶" class="headerlink" title="3.4 é…ç½®GitHub Actionæ–‡ä»¶"></a>3.4 é…ç½®GitHub Actionæ–‡ä»¶</h2><h3 id="3-4-1-åœ¨éœ€è¦å¤‡ä»½çš„ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶é…ç½®æ–‡ä»¶"><a href="#3-4-1-åœ¨éœ€è¦å¤‡ä»½çš„ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶é…ç½®æ–‡ä»¶" class="headerlink" title="3.4.1 åœ¨éœ€è¦å¤‡ä»½çš„ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶é…ç½®æ–‡ä»¶"></a>3.4.1 åœ¨éœ€è¦å¤‡ä»½çš„ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶é…ç½®æ–‡ä»¶</h3><p>è·¯å¾„ä¸ºï¼š  <strong>.github/workflows/gitee_mirror.yml</strong> ï¼Œå¹¶åœ¨gitee_mirror.ymlä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">'GitHub Actions Mirror'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">[push,</span> <span class="string">delete]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">mirror_to_gitee:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">'Checkout'</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">'Mirror to gitee'</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">pixta-dev/repository-mirroring-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">target_repo_url:</span></span><br><span class="line">            <span class="string">git@gitee.com:xxxxxx/xxxxxx.git</span></span><br><span class="line">          <span class="attr">ssh_private_key:</span></span><br><span class="line">            <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITEE_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šactionä¸­å­˜åœ¨  <a href="https://github.com/marketplace/actions/mirroring-repository" target="_blank" rel="noopener">repository-mirroring-action</a>ï¼Œè¿™ä¸ªæœ‰å…´è¶£çš„å¯ä»¥äº†è§£ã€‚</p>
<h3 id="3-4-2-å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰è¿™å‡ ä¸ªé…ç½®"><a href="#3-4-2-å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰è¿™å‡ ä¸ªé…ç½®" class="headerlink" title="3.4.2 å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰è¿™å‡ ä¸ªé…ç½®"></a>3.4.2 å…¶ä¸­éœ€è¦æ³¨æ„çš„æœ‰è¿™å‡ ä¸ªé…ç½®</h3><p>on : è¯¥é…ç½®é¡¹è¡¨ç¤ºåœ¨æŒ‡å®šæ“ä½œäº‹è¿›è¡ŒåŒæ­¥</p>
<p>target_repo_url ï¼š è¯¥é…ç½®é¡¹å¡«ä»£ç å¤‡ä»½ç›®çš„å¹³å°ä»“åº“çš„ssh åœ°å€</p>
<p>ssh_private_keyï¼š è¯¥é…ç½®å¡«å†™åœ¨GitHubä¸­é…ç½®çš„Secretsã€‚åœ¨æœ¬æ–‡3.3æ­¥éª¤ä¸­æåˆ°è®°ä½çš„Nameï¼Œæˆ‘é…ç½®çš„Nameæ˜¯GITEE_PRIVATE_KEYã€‚</p>
<p>é™„ä¸Šæˆ‘é…ç½®çš„<a href="https://github.com/wind-hu/wind-hu.github.io/blob/master/.github/workflows/gitee_mirror.yml" target="_blank" rel="noopener">workFlow</a>æ–‡ä»¶</p>
<h2 id="3-5-æäº¤é…ç½®æ–‡ä»¶"><a href="#3-5-æäº¤é…ç½®æ–‡ä»¶" class="headerlink" title="3.5 æäº¤é…ç½®æ–‡ä»¶"></a>3.5 æäº¤é…ç½®æ–‡ä»¶</h2><p>åœ¨GitHubçš„Actionsä¸­å¯ä»¥çœ‹åˆ°ç”Ÿæ•ˆçš„workflow</p>
<img style="margin:auto 0;border:1px solid #cce5ff;" src="/2020/08/19/%E4%BD%BF%E7%94%A8GitHub%20Action%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%88%B0Gitee/GitHubAction-3.png" alt="GitHubAction-3.png">

]]></content>
      <categories>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
        <tag>GitHub Action</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼é”-Redisç¯‡</title>
    <url>/2020/05/27/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-Redis%E7%AF%87/</url>
    <content><![CDATA[<blockquote>
<p><strong>æœ¬æ–‡çš„å‡ºç°æ˜¯ä¸ºäº†èƒ½å¤Ÿåˆ†äº«ä¸ªäººæ‰€å­¦çš„ç›¸å…³çŸ¥è¯†ï¼Œæ£€éªŒè‡ªèº«å­¦ä¹ æˆæœã€‚å†…å®¹ä¼šå’Œå…¶ä»–æŠ€æœ¯å­˜åœ¨éƒ¨åˆ†å…³è”ï¼Œå¦‚æœ‰ä»»ä½•æè¿°é”™è¯¯æˆ–è€…è¯´æ˜æœ‰è¯¯çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¤§ä½¬æŒ‡å‡ºã€‚</strong> </p>
</blockquote>
<h1 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h1><p>åœ¨åˆ†å¸ƒå¼é¡¹ç³»ç»Ÿçš„å¤§èƒŒæ™¯ä¸‹ï¼ŒCAPä¸­åˆ†åŒºå®¹é”™æ€§æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¤šèŠ‚ç‚¹çš„åè°ƒå°¤ä¸ºé‡è¦ï¼Œå•ä½“æœåŠ¡ä¸­çš„é”åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å·²æ— æ•ˆï¼Œéœ€è¦å¦è¾Ÿè¹Šå¾„ã€‚æ­¤æ–‡ä»‹ç»æ¯”è¾ƒå¸¸è§çš„ä¸€ç§åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼é”ã€‚ZooKeeperçš„åˆ†å¸ƒå¼é”åç»­Blogæ›´æ–°ä¸­ä»‹ç»ã€‚</p>
<h1 id="2-ç¯å¢ƒ"><a href="#2-ç¯å¢ƒ" class="headerlink" title="2. ç¯å¢ƒ"></a>2. ç¯å¢ƒ</h1><blockquote>
<p>JDKï¼š1.8</p>
<p>IDEï¼šIDEA</p>
<p>Redisï¼šRedis server v=5.0.5 bits=64 ï¼ˆredisé…ç½®æ­¤å¤„ä¸åšèµ˜è¿°ï¼‰</p>
</blockquote>
<h1 id="3-è¯¦è§£"><a href="#3-è¯¦è§£" class="headerlink" title="3.è¯¦è§£"></a>3.è¯¦è§£</h1><p>Redisèƒ½å®ç°åˆ†å¸ƒå¼é”æ˜¯å› ä¸ºå­˜åœ¨ä¸€ä¸ªå‘½ä»¤ï¼šsetnx ,è€Œexå±æ€§ä¿è¯äº†ä¸€äº›å®¹é”™ã€‚</p>
<h2 id="3-1-ä½¿ç”¨LUAè„šæœ¬"><a href="#3-1-ä½¿ç”¨LUAè„šæœ¬" class="headerlink" title="3.1 ä½¿ç”¨LUAè„šæœ¬"></a>3.1 ä½¿ç”¨LUAè„šæœ¬</h2><h3 id="3-1-1-mavenä¾èµ–"><a href="#3-1-1-mavenä¾èµ–" class="headerlink" title="3.1.1 mavenä¾èµ–:"></a>3.1.1 mavenä¾èµ–:</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="3-1-2å®ç°ä»£ç å¦‚ä¸‹"><a href="#3-1-2å®ç°ä»£ç å¦‚ä¸‹" class="headerlink" title="3.1.2å®ç°ä»£ç å¦‚ä¸‹:"></a>3.1.2å®ç°ä»£ç å¦‚ä¸‹:</h3><blockquote>
<p>æ³¨ï¼šè°ƒç”¨æ—¶valueç»“æœä¸šåŠ¡è®¾å®šï¼Œè¿‡æœŸæ—¶é—´ä¹Ÿå¯ä»¥å½“å‚æ•°ä¼ å…¥ã€‚å½“ä¸šåŠ¡çš„èŠ±è´¹æ—¶é—´æ³¢åŠ¨æ¯”è¾ƒå¤§ï¼Œéœ€è¦æ·»åŠ å®ˆæŠ¤çº¿ç¨‹è¿›è¡Œç»­å‘½ï¼Œç¡®ä¿ä¸šåŠ¡ä¸ä¼šå› ä¸ºé”çš„è¿‡æœŸæ—¶é—´å¤ªçŸ­å‡ºç°é—®é¢˜ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisDistributedLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æœŸæ—¶é—´10min</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;redis.expireTime:600000&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> EXPIRE_TIMEOUT = <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Long SUCCESS = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ é”</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   redis key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value redis value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦ä¸Šé”æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Strings.isBlank(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String script = <span class="string">"if redis.call('setNx',KEYS[1],ARGV[1]) then if redis.call('get',KEYS[1])==ARGV[1] then return redis.call('expire',KEYS[1],ARGV[2]) else return 0 end end"</span>;</span><br><span class="line">            RedisScript&lt;String&gt; redisScript = <span class="keyword">new</span> DefaultRedisScript&lt;&gt;(script, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            Object result = redisTemplate.execute(redisScript, Collections.singletonList(key), value, String.valueOf(EXPIRE_TIMEOUT));</span><br><span class="line">            <span class="keyword">if</span> (SUCCESS.equals(result)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"redis lock failed"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£é”</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key redis key </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value redis value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦è§£é”æˆåŠŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">unlock</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        String script = <span class="string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"</span>;</span><br><span class="line">        RedisScript&lt;String&gt; redisScript = <span class="keyword">new</span> DefaultRedisScript&lt;&gt;(script, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Object result = redisTemplate.execute(redisScript, Collections.singletonList(key), value);</span><br><span class="line">        <span class="keyword">if</span> (SUCCESS.equals(result)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-ç°æœ‰æ¡†æ¶redisson"><a href="#3-2-ç°æœ‰æ¡†æ¶redisson" class="headerlink" title="3.2 ç°æœ‰æ¡†æ¶redisson"></a>3.2 ç°æœ‰æ¡†æ¶redisson</h2><h3 id="3-2-1-mavenä¾èµ–"><a href="#3-2-1-mavenä¾èµ–" class="headerlink" title="3.2.1 mavenä¾èµ–"></a>3.2.1 mavenä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-ä»£ç å®ç°å¦‚ä¸‹ï¼š"><a href="#3-2-2-ä»£ç å®ç°å¦‚ä¸‹ï¼š" class="headerlink" title="3.2.2 ä»£ç å®ç°å¦‚ä¸‹ï¼š"></a>3.2.2 ä»£ç å®ç°å¦‚ä¸‹ï¼š</h3><h4 id="3-2-2-1-æ ¹æ®å®˜æ–¹javadocè¯´æ˜ï¼Œä½¿ç”¨redissonå®ç°åˆ†å¸ƒå¼é”çš„ä¾‹å­å¦‚ä¸‹ï¼š"><a href="#3-2-2-1-æ ¹æ®å®˜æ–¹javadocè¯´æ˜ï¼Œä½¿ç”¨redissonå®ç°åˆ†å¸ƒå¼é”çš„ä¾‹å­å¦‚ä¸‹ï¼š" class="headerlink" title="3.2.2.1 æ ¹æ®å®˜æ–¹javadocè¯´æ˜ï¼Œä½¿ç”¨redissonå®ç°åˆ†å¸ƒå¼é”çš„ä¾‹å­å¦‚ä¸‹ï¼š"></a>3.2.2.1 æ ¹æ®å®˜æ–¹javadocè¯´æ˜ï¼Œä½¿ç”¨redissonå®ç°åˆ†å¸ƒå¼é”çš„ä¾‹å­å¦‚ä¸‹ï¼š</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Acquires the lock only if it is free at the time of invocation.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Acquires the lock if it is available and returns immediately</span></span><br><span class="line"><span class="comment">     * with the value &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">     * If the lock is not available then this method will return</span></span><br><span class="line"><span class="comment">     * immediately with the value &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;A typical usage idiom for this method would be:</span></span><br><span class="line"><span class="comment">     *  &lt;pre&gt; &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * Lock lock = ...;</span></span><br><span class="line"><span class="comment">     * if (lock.tryLock()) &#123;</span></span><br><span class="line"><span class="comment">     *   try &#123;</span></span><br><span class="line"><span class="comment">     *     // manipulate protected state</span></span><br><span class="line"><span class="comment">     *   &#125; finally &#123;</span></span><br><span class="line"><span class="comment">     *     lock.unlock();</span></span><br><span class="line"><span class="comment">     *   &#125;</span></span><br><span class="line"><span class="comment">     * &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *   // perform alternative actions</span></span><br><span class="line"><span class="comment">     * &#125;&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * This usage ensures that the lock is unlocked if it was acquired, and</span></span><br><span class="line"><span class="comment">     * doesn't try to unlock if the lock was not acquired.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the lock was acquired and</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> false&#125; otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-2-æ­¤å¤„æä¾›åŸºç¡€çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒredissonåŒ…å«çš„å¾ˆå¤šç±»å‹çš„é”ï¼ŒåŒ…æ‹¬å…¬å¹³é”ï¼Œé”ç»„ï¼Œè¯»å†™é”ç­‰ï¼Œæ­¤å¤„ä¸é€ä¸€ä»‹ç»ã€‚ä¸éš¾å‘ç°ï¼Œredissonçš„é”å’Œjavaæä¾›çš„æ˜¾å¼é”ç”¨æ³•ä¸€è‡´ã€‚"><a href="#3-2-2-2-æ­¤å¤„æä¾›åŸºç¡€çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒredissonåŒ…å«çš„å¾ˆå¤šç±»å‹çš„é”ï¼ŒåŒ…æ‹¬å…¬å¹³é”ï¼Œé”ç»„ï¼Œè¯»å†™é”ç­‰ï¼Œæ­¤å¤„ä¸é€ä¸€ä»‹ç»ã€‚ä¸éš¾å‘ç°ï¼Œredissonçš„é”å’Œjavaæä¾›çš„æ˜¾å¼é”ç”¨æ³•ä¸€è‡´ã€‚" class="headerlink" title="3.2.2.2 æ­¤å¤„æä¾›åŸºç¡€çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒredissonåŒ…å«çš„å¾ˆå¤šç±»å‹çš„é”ï¼ŒåŒ…æ‹¬å…¬å¹³é”ï¼Œé”ç»„ï¼Œè¯»å†™é”ç­‰ï¼Œæ­¤å¤„ä¸é€ä¸€ä»‹ç»ã€‚ä¸éš¾å‘ç°ï¼Œredissonçš„é”å’Œjavaæä¾›çš„æ˜¾å¼é”ç”¨æ³•ä¸€è‡´ã€‚"></a>3.2.2.2 æ­¤å¤„æä¾›åŸºç¡€çš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒredissonåŒ…å«çš„å¾ˆå¤šç±»å‹çš„é”ï¼ŒåŒ…æ‹¬å…¬å¹³é”ï¼Œé”ç»„ï¼Œè¯»å†™é”ç­‰ï¼Œæ­¤å¤„ä¸é€ä¸€ä»‹ç»ã€‚ä¸éš¾å‘ç°ï¼Œredissonçš„é”å’Œjavaæä¾›çš„æ˜¾å¼é”ç”¨æ³•ä¸€è‡´ã€‚</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisSonDistributedLock</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Redisson redisson;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æœŸæ—¶é—´10min</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;redis.expireTime:600000&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> EXPIRE_TIMEOUT = <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redissonDistributedLockDemo</span><span class="params">(<span class="keyword">final</span> String key)</span> </span>&#123;</span><br><span class="line">        RLock lock = redisson.getLock(key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> isLock = lock.tryLock(EXPIRE_TIMEOUT, TimeUnit.MILLISECONDS);</span><br><span class="line">            <span class="keyword">if</span> (isLock) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> ä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            log.error(<span class="string">"tryLock failed."</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ­¤æ¬¡ä»‹ç»çš„åˆ†å¸ƒå¼é”ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„å±•ç¤ºï¼Œå…·ä½“çš„ä½¿ç”¨ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡å¤„ç†ã€‚</p>
<p>æ¯”å¦‚Luaå®ç°çš„åˆ†å¸ƒå¼é”ï¼Œå½“ä¸šåŠ¡å¤„ç†æ‰€éœ€æ—¶é—´æ³¢åŠ¨æ¯”è¾ƒå¤§æ—¶ï¼Œé¢„è®¾çš„è¿‡æœŸæ—¶é—´ä¸å¥½åˆ¶å®šæ—¶ï¼Œéœ€è¦æ·»åŠ å®ˆæŠ¤çº¿ç¨‹è¿›è¡Œç»­å‘½ï¼›åŒæ—¶ä¹Ÿå¯ä»¥æ·»åŠ é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿åŠ é”æ—¶ä¸ä¼šå› ä¸ºå…¶ä»–éé”å ç”¨å› ç´ å¯¼è‡´åŠ é”å¤±è´¥ã€‚</p>
<br>]]></content>
      <categories>
        <category>Java</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
</search>
